# 关于云药房产品费率管理模块业务设计

## 费率相关主体

- 合伙人费率实体

  - 费率编号
  - 合伙人标识
  - 基准费率（保留两位小数）
  - 生效日期（YYYY-MM-DD)
  - 失效日期（YYYY-MM-DD）

- 合伙人优惠费率实体

  - 费率编号
  - 合伙人标识
  - 优惠费率（保留两位小数）
  - 优惠起始日期（YYYY-MM-DD)
  - 优惠结束日期（YYYY-MM-DD)
  - 生效日期（YYYY-MM-DD)
  - 失效日期（YYYY-MM-DD）

- 特殊品种费率实体

  - 费率编号
  - 品种标识（productid）
  - 药品辅助标识（medicineid）
  - 费率（保留两位小数）
  - 生效日期（YYYY-MM-DD)
  - 失效日期（YYYY-MM-DD)

## 费率管理功能

### 合作伙伴费率设置

- 新增合作伙伴

  - 增加合作伙伴基础费率、优惠费率设置功能
  - 费率生效时期为当天

- 合作伙伴维护

  - 增加合作伙伴基础费率、优惠费率维护功能
  - 原有费率记录的失效日期为当天，创建新的费率记录标记生效日期为明天

- 合作伙伴费率初始化

  - 初始化原有合作伙伴的费率数据

### 合作伙伴品种上架费率管理

- 合作伙伴产品执行上架操作时，发生
- 在后台运营审核时，增加是否配置特殊品种费率选择。如果用户选择是，则可以进行特殊品种费率的配置
- 同时，增加辅助配置费率功能：即，选择系统当中存在的相同药品辅助标识（medicineid）的特殊费率配置展现给用户，便于参考（参考已经配置过的特殊费率是什么样的）。
- 如果之前配置过相同(medicineid)的特殊费率，那么在审核页面要提示用户，以避免漏过。

### 品种费率维护

- 增加品种费率维护功能页面，该页面旨在对于已经设置的品种费率进行修订、删除、新增等操作；
- 所有的变更操作都必须有操作日志；
- 该页面还需要提供查询功能，来方便检索后配置。例如（如何针对某一个合作伙伴所辖品种进行费率配置？如何针对某一个品种，在不同合作伙伴销售的费率等？）
- 品种的费率变更需要将原有的费率失效日期标志为当天，同时新建一条费率记录，生效日期为明天

### 品种费率表导出

- 费率表的导出功能，入口可以设置在品种费率维护页面；
- 费率导出需要支持（按照品种1或者多个导出，按照合伙人导出）
- 费率变更记录导出（按照品种1或者多个的变更记录，即这个费率什么时间生成的，谁变更了这个费率，什么时间变更的，变更成为多少）

### 清分记录查询

- 这部分功能旨在，查询清分系统的日志记录并展现。
- 业务目的是在于，辅助检查清分系统在清分过程当中执行的费率是否正确。

## 订单系统功能扩展

- 订单系统要在订单生成时刻，根据合伙人标识以及订单包含品种标识，计算并存储费率相关记录。具体规则如下：
- 首先，根据合伙人标识查询当前有效的基础费率和优惠费率。如果在优惠期内，则取值优惠费率，否则取值基础费率；
- 其次，根据订单内包含商品的品种标识来查询当前生效的特殊品种费率，如果存在特殊品种费率，则取值特殊品种费率，否则取值基础费率或者优惠费率；
- 最后，将最终确定的费率标识以及费率数字记录下来；
- 接下来，在支付时，当做参数传入支付系统。

## 清分系统功能扩展

- 支付系统扩展数据字段，记录应用系统传入的：费率编码、费率等参数
- 清分系统按照记录参数进行计算并完成清分操作，同时记录日志。日志一条很重要的标识信息，就是执行的费率标识。
- 考虑到多应用可能会采用不同的费率规则，因此，建议考虑增加业务类型标识记录来区分。
